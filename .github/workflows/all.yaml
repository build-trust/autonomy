name: All

permissions:
  contents: read

on:
  merge_group:
  pull_request:
  push:
    branches:
      - main
  workflow_dispatch:
    inputs:
      commit_sha:
        description: Git commit sha, on which, to run this workflow

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}-${{ github.event_name }}
  cancel-in-progress: true

defaults:
  run:
    shell: nix develop ./tools/nix --command bash {0}

jobs:
  lint-spacing-and-indentation:
    name: All - lint-spacing-and-indentation
    runs-on: ubuntu-24.04
    steps:
      - name: Checkout
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683
        with:
          ref: ${{ github.event.inputs.commit_sha }}

      - name: Install Nix
        id: nix-installer
        uses: ./.github/actions/cache_nix
        with:
          cache-unique-id: all

      - name: Lint Spacing and Indentation
        run: make lint-spacing-and-indentation

      - name: Cache Nix Store
        uses: ./.github/actions/nix_upload_store
        if: ${{ steps.nix-installer.outputs.cache-hit != 'true' }}

  lint-commit-messages:
    name: All - lint-commit-messages
    runs-on: ubuntu-24.04
    steps:
      - name: Checkout
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683
        with:
          ref: ${{ github.event.inputs.commit_sha }}

      - name: Install Nix
        id: nix-installer
        uses: ./.github/actions/cache_nix
        with:
          cache-unique-id: all

      - name: Lint Commit Messages
        run: make lint-commit-messages

      - name: Cache Nix Store
        uses: ./.github/actions/nix_upload_store
        if: ${{ steps.nix-installer.outputs.cache-hit != 'true' }}
